## 工单状态

0. 待网点接收
1. 待派工
2. 服务中
3. 待回访待结算
4. 已回访待结算
5. 已完成
6. 取消工单
7. 暂不派工
8. 无效工单

-> 默认1

## 一级网点工单状态

1. 待派工
2. 待二级网点接收
3. 服务中
4. 服务完成待回访
5. 已回访 
6. 已退回
7. 暂不派工

## 派工状态

* 1.待接单
* 2.已接单待上门
* 3.已拒单待派工
* 4.已上门维修中
* 5.维修已完工
* 6.已转派
* 7.派工取消

## 系统角色

* 售后服务商：role_id=3
* system：role_id=2
* pc使用人员：role_id=4，现在sys_role表中的信息专员其实就pc使用人员

## 网点权限说明

### 网点默认角色id(crm_site_role_permission中的sys_role_id字段)

* 1 信息员
* 2 配件员
* 3 财务人员

### crm_site_default_nonservice_permission

存的是网点默认角色的权限(1,2,3)，permissions存的就是sys_menu表中的id

### crm_site_role_permission

存的是网点自定义角色的权限，包括网点默认角色也是可以自定义的。

### sys_menu 权限说明

sys_menu在我们这个系统中，更像是一个权限表，但是它包含菜单表（菜单的target是空或者是null）。

target字段说明：

* ''或null:admin分配的菜单;
* '1':服务商分配的tab页面权限;
* '2':tab页面上的按钮;
* '3':固定其他权限;
* '4':其他权限下的按钮;
* '10':system运营人员使用的权限值;

### crm_non_serviceman_role_rel

pc使用人员的角色关联表，一个pc使用人员可能有多个site_role(site role可能是自定义的，也可能是网点默认角色)

## 其他权限说明

###注意:

1. 其他权限是直接从一级菜单下面添加的，即：其他权限的parent_id为一级菜单的menu_id
2. [其他权限]的target_id固定取值为 3 , href取值后缀默认为:xxxx_OTHERS
3. [其他权限]下面的具体权限的target_id固定取值为 4 , href取值后缀默认为 xxxx_BTN_OTHERS

```
# 添加一级菜单 [工单管理] 下面的 [其他权限] 目录
insert into sys_menu values (
'da24504e54788935aa2d4bf4b20d6a04', '4300551da6f44d3eab5c9c760b1b74c7', '0,1,4300551da6f44d3eab5c9c760b1b74c7,', 
'其他权限', 'ORDER_OTHERS', '3', NULL, '10', '1', NULL, NULL, '1', '2017-06-22 15:57:48', NULL, NULL, NULL, '0'
);

# 添加[工单管理] -> [其他权限] 下面的结算权限
insert into sys_menu values (
'2739dfdbe32d4e7127dbd4d9a08f451b', 'da24504e54788935aa2d4bf4b20d6a04', '0,1,4300551da6f44d3eab5c9c760b1b74c7,da24504e54788935aa2d4bf4b20d6a04,', 
'结算', 'ORDER_SETTLEMENT_BTN_OTHERS', '4', NULL, '10', '1', NULL, NULL, '1', '2017-06-22 15:57:48', NULL, NULL, NULL, '0'
);

# 添加[工单管理] -> [其他权限] 下面的重新结算权限
insert into sys_menu values (
'4a5428fadf23298be8496000e655bc9c', 'da24504e54788935aa2d4bf4b20d6a04', '0,1,4300551da6f44d3eab5c9c760b1b74c7,da24504e54788935aa2d4bf4b20d6a04,', 
'重新结算', 'ORDER_RESETTLEMENT_BTN_OTHERS', '4', NULL, '10', '1', NULL, NULL, '1', '2017-06-22 15:57:48', NULL, NULL, NULL, '0'
)

# 添加[工单管理] -> [其他权限] 下面的重新结算审核权限
insert into sys_menu values (
'1dc807974d7fe5aa76885121bc01af2a', 'da24504e54788935aa2d4bf4b20d6a04', '0,1,4300551da6f44d3eab5c9c760b1b74c7,da24504e54788935aa2d4bf4b20d6a04,', 
'结算审核', 'ORDER_SETTLEMENT_REVIEW_BTN_OTHERS', '4', NULL, '10', '1', NULL, NULL, '1', '2017-06-22 15:57:48', NULL, NULL, NULL, '0'
)
;
```
## 续费方案

老会员到期续费方案：

* 1、到期提醒：在到期前3个月开始首次提醒，首次提醒后每十天提醒一次，到期前7天每天提醒一次，服务商账号登陆系统后提示到期弹窗，弹窗关闭后在系统顶部的菜单栏用小图标显示，点击小图标可以打开到期提醒弹窗；
* 2、续费方案：截止到目前为止，所有会员的购买价格分为1825元/年（5折）、2190元/年（6折）、2920元/年（8折），5折和6折购买的会员到期前续费购买1年、2年、3年VIP会员将享受原折扣，购买1个月、6个月VIP会员按现价执行；5折、6折用户会员到期后再续费会员按照最新价格执行，不享受优惠。添加5折、6折续费弹窗，直接显示老会员当前可享受的续费价格。

## 南岛

南岛目前有10A和16A的，可以合在一起购买，对10A和16A的分别生成一个订单，但是运费只存在其中一张订单里面。订单编号规则：xxxxxxx,xxxxxxxx_1

## 400工单完工状态

海尔：

* 网点结单
* 异常结单
* 海尔结单通过
* 费用已生成
* 已回访

海信：

{"9", "10", "12", "17", "20", "30", "49", "50", "51", "52"}

美的：

{"21", "22", "18", "19", "17"}


惠而浦：

{"D", "C1", "C2"}

## 二级网点工单的一些限制

* 一级网点派给二级网点的工单，是不能被二级网点标记为无效工单的。

## 一些可能会扯皮的修改

* 在2017工单备份中，待派工和服务中的工单是可以直接封单的，而在最新工单中，只有待回访和结算的工单才可以直接封单。